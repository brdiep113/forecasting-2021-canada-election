---
title: "Modelling"
author: "Eric Zhu, Brian Diep, Tanvir Hyder, Ashley Zhang, Kristin Huang"
date: "09/19/2021"
output:
  pdf_document: 
    toc: yes
    toc_depth: 3
    extra_dependencies: ["float"]
header-includes:
- \usepackage{fancyhdr}
- \usepackage[T1]{fontenc}
- \usepackage{lmodern}
- \usepackage{bm}
- \usepackage[ruled,vlined]{algorithm2e}
- \usepackage{setspace}
- \usepackage{fancyhdr}
- \pagestyle{fancy}
- \usepackage{float}
- \floatplacement{figure}{H}
- \fancyhead[LO,LE]{Eric Zhu, Brian Diep, Tanvir Hyder, Ashley Zhang, Kristin Huang}
---

```{r}
library(tidyverse)
library(ggplot2)
library(dplyr)
library(brms)
library(lme4)

predictors_df <- read_csv("predictors_dataframe.csv")
predictors_df <- predictors_df %>%
  select(-c(1:3, 6))
names(predictors_df) <- c('home_ownership', 'income_bracket', 'is_immigrant',
                          'education', 'language', 'votechoice', 'age_bracket',
                          'province')

```

```{r}
model <- nnet::multinom(votechoice ~ education + income_bracket + home_ownership + language + is_immigrant + age_bracket, data = predictors_df, maxit=500)
broom::tidy(model)
#summary(model)
```

```{r}
library(caret)

predictors_df$votechoice <- as.factor(predictors_df$votechoice)
poststrat_data <- read_csv('../poststrat.csv')
poststrat_data <- poststrat_data %>%
  select(-c(1))
predicted_vote <- predict(model, type="class", newdata=poststrat_data)
pred <- data.frame(predicted_vote)
poststrat_data <- cbind(poststrat_data, predicted_vote)
```


```{r}

poststrat_data_j <- poststrat_data %>%
  select(c(Riding, prop, predicted_vote)) %>% 
  group_by(Riding, predicted_vote) %>%
  summarise_all(sum) %>% 
  group_by(Riding) %>% 
  top_n(n=1)

```
# Check dataframe 
```{r}
predicted_summaries <- poststrat_data_j %>% group_by(predicted_vote) %>% dplyr::summarise(n =n())

```
